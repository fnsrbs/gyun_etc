<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì˜¤ëŠ˜ì˜ ê¸‰ì‹ ì •ë³´</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; margin: 20px; }
        h1 { color: #333; }
        #meals { margin-top: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 5px; display: inline-block; text-align: left; padding: 15px; }
    </style>
</head>
<body>

    <div id="meals">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

    <script>
        function getTodayInfo() {
            const today = new Date();
            const year = today.getFullYear();
            const month = String(today.getMonth() + 1).padStart(2, "0");
            const day = String(today.getDate()).padStart(2, "0");

            const weekdays = ["ì¼ìš”ì¼", "ì›”ìš”ì¼", "í™”ìš”ì¼", "ìˆ˜ìš”ì¼", "ëª©ìš”ì¼", "ê¸ˆìš”ì¼", "í† ìš”ì¼"];
            const weekday = weekdays[today.getDay()]; // ìš”ì¼ ê°€ì ¸ì˜¤ê¸°

            return {
                dateStr: `${year}ë…„ ${month}ì›” ${day}ì¼ (${weekday})`,
                neisDate: `${year}${month}${day}`
            };
        }

        const { dateStr, neisDate } = getTodayInfo();

        const API_KEY = "25ab112985ae4d408a9ff59278a983ad";
        const ATPT_OFCDC_SC_CODE = "J10";  
        const SD_SCHUL_CODE = "7530102";  

        const url = `https://open.neis.go.kr/hub/mealServiceDietInfo?KEY=${API_KEY}&Type=json&ATPT_OFCDC_SC_CODE=${ATPT_OFCDC_SC_CODE}&SD_SCHUL_CODE=${SD_SCHUL_CODE}&MLSV_YMD=${neisDate}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const mealDiv = document.getElementById("meals");
                try {
                    let meals = data["mealServiceDietInfo"][1]["row"];
                    let htmlContent = `<h3>ğŸ“… ${dateStr} ê¸‰ì‹ ì •ë³´</h3><hr>`;  // ë‚ ì§œëŠ” ê¸‰ì‹ ë‚´ë¶€ì—ì„œë§Œ í‘œì‹œ
                    meals.forEach(meal => {
                        let menu = meal["DDISH_NM"]
                            .replace(/<br\/>/g, "<br>")  // ì¤„ë°”ê¿ˆ ì²˜ë¦¬
                            .replace(/\d+\./g, "")      // '1.', '2.' ê°™ì€ ë²ˆí˜¸ ì œê±°
                            .replace(/\([^)]*\)/g, "")  // ê´„í˜¸ ë° ê´„í˜¸ ì•ˆì˜ ë‚´ìš© ì œê±°
                            .replace(/ê³ |ììœ¨|ã…¡|ì™„/g, "") // 'ê³ ', 'ììœ¨', 'ã…¡', 'ì™„' ì œê±°
                            .replace(/\s+/g, " ")       // ê³µë°± ì •ë¦¬

                        htmlContent += `<h3>ğŸ½ï¸ ${meal["MMEAL_SC_NM"]}</h3>`;
                        htmlContent += `<p>${menu}</p><hr>`;
                    });
                    mealDiv.innerHTML = htmlContent;
                } catch (error) {
                    mealDiv.innerHTML = `<h3>ğŸ“… ${dateStr} ê¸‰ì‹ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.</h3>`;
                }
            })
            .catch(error => {
                document.getElementById("meals").innerHTML = `<h3>ê¸‰ì‹ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</h3>`;
            });
    </script>
</body>
</html>
